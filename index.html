<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cultura Viva | Gestão de Ecossistema</title>
    <!-- Tailwind & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: 'var(--primary)',
                            hover: 'var(--primary-hover)',
                            light: 'var(--primary-light)',
                        },
                        success: {
                            DEFAULT: 'var(--success)',
                            light: 'var(--success-light)',
                        },
                        warning: {
                            DEFAULT: 'var(--warning)',
                            light: 'var(--warning-light)',
                        },
                        danger: {
                            DEFAULT: 'var(--danger)',
                            light: 'var(--danger-light)',
                        },
                        info: {
                            DEFAULT: 'var(--info)',
                        },
                        brand: {
                            50: 'var(--slate-50)',
                            100: 'var(--slate-100)',
                            200: 'var(--slate-200)',
                            300: 'var(--slate-300)',
                            400: 'var(--slate-400)',
                            500: 'var(--slate-500)',
                            600: 'var(--slate-600)',
                            700: 'var(--slate-700)',
                            800: 'var(--slate-800)',
                            900: 'var(--slate-900)',
                        }
                    },
                    borderRadius: {
                        'base': 'var(--border-radius-base)',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Vue.js 3 & Lucide Icons -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- ✅ SOLID REFACTOR: Constantes e Utilitários -->
    <script src="js/config/Constants.js"></script>
    <script src="js/config/Themes.js"></script>

    <!-- Services -->
</head>

<body>
    <div id="app" v-cloak :class="[adminThemeClass, { 'is-compact': settings.isCompactMode }]">
        <!-- GLOBAL CONFIRM DIALOG -->
        <base-confirm-dialog :show="confirmModal.state.show" :title="confirmModal.state.title"
            :message="confirmModal.state.message" :confirm-label="confirmModal.state.confirmLabel"
            :cancel-label="confirmModal.state.cancelLabel" :type="confirmModal.state.type"
            @confirm="confirmModal.handleConfirm" @cancel="confirmModal.handleCancel"></base-confirm-dialog>

        <!-- 6.2 MODO MANUTENÇÃO (BLOQUEIO PÚBLICO) -->
        <div v-if="showMaintenanceBlock"
            class="fixed inset-0 z-[2000] bg-surface flex flex-col items-center justify-center p-6 text-center">
            <div
                class="w-20 h-20 bg-warning-light text-warning rounded-full flex items-center justify-center mb-6 border-main">
                <base-icon name="wrench" icon-class="w-10 h-10"></base-icon>
            </div>
            <h1 class="text-3xl font-bold mb-2">Página em Manutenção</h1>
            <p class="text-brand-500 max-w-md">Estamos a atualizar o portal para lhe oferecer uma melhor experiência.
                Voltamos em breve!</p>
            <button @click="router.pushContext('auth')"
                class="mt-8 text-primary font-bold text-sm uppercase tracking-widest hover:underline">Acesso
                Administrativo</button>
        </div>

        <!-- 4.3 SISTEMA GLOBAL DE NOTIFICAÇÕES (NOTIFICAÇÕES NO TOPO) -->
        <div class="fixed top-6 right-6 z-[9999] flex flex-col gap-3 pointer-events-none">
            <transition-group name="fade">
                <div v-for="toast in notifications.toasts" :key="toast.id"
                    class="pointer-events-auto px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-4 border-main bg-surface relative overflow-hidden system-toast min-w-[320px] group/toast"
                    :class="{
                        'border-success-light text-success': toast.type === 'success',
                        'border-danger-light text-danger': toast.type === 'danger' || toast.type === 'error',
                        'border-warning-light text-warning': toast.type === 'warning',
                        'border-info-light text-info': toast.type === 'info'
                    }">

                    <!-- Icon -->
                    <div class="p-2 rounded-lg shrink-0" :class="{
                            'bg-success-light': toast.type === 'success',
                            'bg-danger-light': toast.type === 'danger' || toast.type === 'error',
                            'bg-warning-light': toast.type === 'warning',
                            'bg-info-light': toast.type === 'info'
                        }">
                        <base-icon :name="
                            toast.type === 'success' ? 'check-circle' : 
                            (toast.type === 'warning' ? 'alert-triangle' : 
                            (toast.type === 'info' ? 'info' : 'alert-circle'))" icon-class="w-5 h-5"></base-icon>
                    </div>

                    <!-- Content -->
                    <div class="flex-1 flex flex-col">
                        <span class="font-bold text-[10px] uppercase tracking-widest opacity-60 mb-0.5">
                            {{ toast.type === 'success' ? 'Sucesso' : (toast.type === 'warning' ? 'Atenção' :
                            (toast.type === 'info' ? 'Sistema' : 'Erro')) }}
                        </span>
                        <span class="font-medium text-sm leading-tight">{{ toast.message }}</span>
                    </div>

                    <!-- Close Button -->
                    <div class="shrink-0">
                        <button @click="notifications.remove(toast.id)"
                            class="w-10 h-10 rounded-full hover:bg-brand-50 flex items-center justify-center transition-colors group/close focus:outline-none">
                            <base-icon name="x"
                                icon-class="w-5 h-5 text-brand-300 group-hover/close:text-brand-600 transition-colors"></base-icon>
                        </button>
                    </div>

                    <!-- PROGRESS BAR SYSTEM -->
                    <div class="absolute bottom-0 left-0 w-full h-1 bg-brand-100/50"></div> <!-- Track -->
                    <div class="absolute bottom-0 left-0 h-1 bg-current opacity-60"
                        :style="{ width: toast.progress + '%' }"></div> <!-- Progress -->
                </div>
            </transition-group>
        </div>

        <!-- CONTEXTO: LANDING PAGE (PÚBLICO) -->
        <div v-if="router.currentContext === 'public'">

            <!-- MAINTENANCE ALERT FOR ADMINS -->
            <div v-if="settings.isMaintenance && auth.isAuthenticated && ['admin', 'dev'].includes(auth.user?.role)"
                class="fixed top-0 left-0 w-full z-[100] bg-warning text-brand-900 px-4 py-2 text-center text-[10px] font-bold uppercase tracking-widest shadow-md flex items-center justify-center gap-3 border-b border-warning-light backdrop-blur-sm">
                <base-icon name="alert-triangle" icon-class="w-4 h-4"></base-icon>
                <span>Modo Manutenção Ativo — O site está oculto para o público</span>
            </div>

            <nav class="fixed w-full transition-all duration-300" :class="[
                    isScrolled ? ('glass shadow-sm text-brand-800 ' + (settings.isCompactMode ? 'py-2' : 'py-4')) : ('bg-transparent text-white ' + (settings.isCompactMode ? 'py-3' : 'py-6')),
                    ui.userMenuOpen ? 'z-[10001]' : 'z-50'
                ]">
                <div class="max-w-7xl mx-auto px-6 flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center text-white transition-colors duration-300"
                            :class="isScrolled ? 'bg-primary' : 'bg-white/20 backdrop-blur-md'">
                            <base-icon :name="settings.brandIcon" icon-class="w-5 h-5"></base-icon>
                        </div>
                        <span class="font-bold text-xl tracking-tight uppercase"
                            :class="isScrolled ? 'text-brand-800' : 'text-white'">{{
                            settings.appTitle }}</span>
                    </div>
                    <div class="hidden md:flex gap-8 font-medium text-sm uppercase tracking-widest items-center">
                        <a href="#inicio" class="transition hover:opacity-70"
                            :class="isScrolled ? 'hover:text-primary' : 'hover:text-white'">Início</a>
                        <a href="#eventos" class="transition hover:opacity-70"
                            :class="isScrolled ? 'hover:text-primary' : 'hover:text-white'">Eventos</a>
                        <button @click="router.push('clipping')" class="transition focus:outline-none hover:opacity-70"
                            :class="isScrolled ? 'hover:text-primary' : 'hover:text-white'">Clipagem</button>
                    </div>

                    <div class="flex items-center gap-4">
                        <div v-if="auth.isAuthenticated && auth.user"
                            class="flex items-center gap-4 border-l pl-6 ml-4 transition-colors duration-300"
                            :class="isScrolled ? 'border-brand-200/50' : 'border-white/20'">

                            <div class="relative">
                                <!-- IDENTITY & AVATAR (TOGGLE MENU) -->
                                <button @click="ui.userMenuOpen = !ui.userMenuOpen"
                                    class="flex items-center gap-3 hover:opacity-80 transition-opacity relative group">
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center text-white font-bold border-2 shadow-lg shrink-0 relative transition-colors duration-300"
                                        :class="isScrolled ? 'bg-primary border-white' : 'bg-white/20 border-white/50 backdrop-blur-md'">
                                        <img v-if="auth.user?.photo" :src="auth.user?.photo"
                                            class="w-full h-full object-cover rounded-full">
                                        <span v-else>{{ auth.user?.name?.charAt(0) || '?' }}</span>

                                        <!-- OVERLAY NOTIFICATION PIN -->
                                        <span v-if="settings.unreadNotifications > 0"
                                            class="absolute -top-1 -right-1 w-3.5 h-3.5 bg-danger rounded-full border-2 border-white z-20 animate-pulse"></span>
                                    </div>
                                </button>

                            </div>
                        </div>
                        <button v-else @click="router.pushContext('auth')"
                            class="rounded-full transition-all duration-300 uppercase text-[10px] font-bold tracking-widest hover:scale-105 shadow-lg"
                            :class="[
                                isScrolled ? 'bg-primary text-white hover:bg-primary-hover shadow-primary-shadow' : 'bg-white text-primary hover:bg-white/90 shadow-brand-900/20',
                                settings.isCompactMode ? 'px-3 py-1.5' : 'px-5 py-2'
                            ]">
                            Login
                        </button>
                    </div>
                </div>
            </nav>

            <!-- USER MENU (PÚBLICO) - Localizado fora do Header para evitar 'Fixed Trap' -->
            <dropdown-menu v-if="ui.userMenuOpen && auth.isAuthenticated && router.currentContext === 'public'"
                :show="ui.userMenuOpen" @update:show="ui.userMenuOpen = $event"
                class="public-user-menu-fixed md:w-64 z-[10001]">

                <!-- Header: User Identity -->
                <div class="px-5 py-4 bg-brand-50/50 border-b border-brand-100 flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white font-bold border border-white shrink-0 relative">
                        <img v-if="auth.user.photo" :src="auth.user.photo"
                            class="w-full h-full object-cover rounded-full">
                        <span v-else>{{ auth.user.name.charAt(0) }}</span>
                    </div>
                    <div class="flex flex-col min-w-0">
                        <span class="text-sm font-bold text-brand-800 truncate text-left">{{ auth.user.name }}</span>
                        <span class="text-[10px] text-brand-400 font-medium truncate text-left">{{ auth.user.email
                            }}</span>
                    </div>
                </div>

                <!-- Menu Items -->
                <button v-if="['admin', 'dev', 'editor'].includes(auth.user?.role)"
                    @click="navContext('admin'); ui.userMenuOpen = false"
                    class="w-full text-left px-4 py-2.5 rounded-xl bg-primary-light text-primary font-bold text-xs flex items-center justify-between transition-colors hover:bg-primary/10 group cursor-pointer">
                    <div class="flex items-center gap-3">
                        <base-icon name="layout-dashboard" icon-class="w-4 h-4"></base-icon>
                        Painel Administrativo
                    </div>
                </button>
                <div v-if="['admin', 'dev', 'editor'].includes(auth.user?.role)" class="h-px bg-brand-50 my-0.5 mx-2">
                </div>

                <button @click="modal.open('users', auth.user); ui.userMenuOpen = false"
                    class="w-full text-left px-4 py-2.5 rounded-xl hover:bg-brand-50 text-brand-600 font-bold text-xs flex items-center gap-3 transition-colors cursor-pointer">
                    <base-icon name="user" icon-class="w-4 h-4 text-brand-400"></base-icon>
                    Meu Perfil
                </button>

                <button @click="settings.isCompactMode = !settings.isCompactMode"
                    class="w-full text-left px-4 py-2.5 rounded-xl hover:bg-brand-50 text-brand-600 font-bold text-xs flex items-center justify-between group transition-colors cursor-pointer">
                    <div class="flex items-center gap-3">
                        <base-icon :name="settings.isCompactMode ? 'maximize' : 'minimize'"
                            icon-class="w-4 h-4 text-brand-400 group-hover:text-primary"></base-icon>
                        <span>Modo Compacto</span>
                    </div>
                    <div class="w-8 h-4 rounded-full relative transition-colors"
                        :class="settings.isCompactMode ? 'bg-primary' : 'bg-brand-200'">
                        <div class="absolute top-0.5 w-3 h-3 bg-white rounded-full transition-all"
                            :style="{ left: settings.isCompactMode ? '1.1rem' : '0.15rem' }"></div>
                    </div>
                </button>

                <div class="h-px bg-brand-50 my-0.5 mx-2"></div>

                <button @click="auth.logout(); ui.userMenuOpen = false"
                    class="w-full text-left px-4 py-2.5 rounded-xl hover:bg-danger-light text-danger font-bold text-xs flex items-center gap-3 transition-colors cursor-pointer">
                    <base-icon name="log-out" icon-class="w-4 h-4 text-danger"></base-icon>
                    Sair
                </button>
            </dropdown-menu>

            <template v-if="!['all-events', 'clipping'].includes(router.current)">
                <main v-if="settings.hero.show" id="inicio"
                    class="relative h-screen flex items-center justify-center overflow-hidden bg-brand-900 text-white pt-16 group/hero">

                    <!-- BACKGROUND SLIDER -->
                    <!-- HERO BACKGROUND -->
                    <div class="absolute inset-0 z-0">
                        <!-- MODE: SLIDER -->
                        <transition-group v-if="settings.hero.mode === 'slider'" :name="settings.hero.animation">
                            <div v-for="(event, index) in activeEvents" :key="event.id"
                                v-show="index === ui.currentHeroSlide"
                                class="absolute inset-0 transition-all duration-1000">
                                <img :src="event.image || 'https://images.unsplash.com/photo-1492684223066-81342ee5ff30'"
                                    class="w-full h-full object-cover opacity-80 ken-burns" loading="lazy">
                            </div>
                        </transition-group>

                        <!-- MODE: FIXED IMAGE -->
                        <div v-if="settings.hero.mode === 'fixed'" class="absolute inset-0">
                            <img :src="settings.hero.fixedImage || 'https://images.unsplash.com/photo-1492684223066-81342ee5ff30'"
                                class="w-full h-full object-cover opacity-80 ken-burns">
                        </div>

                        <!-- Fallback (Empty Slider) -->
                        <div v-if="settings.hero.mode === 'slider' && activeEvents.length === 0"
                            class="absolute inset-0">
                            <img src="https://images.unsplash.com/photo-1492684223066-81342ee5ff30"
                                class="w-full h-full object-cover opacity-80 ken-burns">
                        </div>
                    </div>

                    <!-- Gradient Overlay -->
                    <div class="absolute inset-0 hero-gradient pointer-events-none z-10"></div>

                    <!-- CONTEÚDO FIXO ORIGINAL (Restaurado) -->
                    <div class="relative z-20 text-center px-6 max-w-4xl animate-in fade-in zoom-in duration-1000">
                        <h1 v-if="settings.hero.title"
                            class="text-5xl md:text-7xl font-bold mb-8 leading-tight whitespace-pre-wrap text-transparent bg-clip-text bg-gradient-to-r from-white via-primary-light to-success">
                            {{ settings.hero.title }}
                        </h1>
                        <p v-if="settings.hero.subtitle"
                            class="text-xl md:text-2xl text-brand-200 mb-10 font-light max-w-2xl mx-auto">
                            {{ settings.hero.subtitle }}
                        </p>

                        <!-- CTA DA HERO -->
                        <div v-if="settings.hero.ctaShow" class="mt-8">
                            <a :href="settings.hero.ctaLink"
                                class="inline-flex items-center gap-3 px-10 py-4 rounded-full bg-primary text-white font-bold uppercase tracking-widest shadow-xl shadow-primary/40 hover:bg-primary-hover hover:-translate-y-1 transition-all duration-300">
                                {{ settings.hero.ctaText }}
                                <base-icon v-if="settings.hero.icon" :name="settings.hero.icon"
                                    icon-class="w-5 h-5"></base-icon>
                            </a>
                        </div>
                    </div>
                </main>

                <!-- SECTION: STATS (DINÂMICO) -->
                <!-- SECTION: STATS (DINÂMICO) -->
                <!-- SECTION: STATS (DINÂMICO) -->
                <div v-show="settings.stats.show && (settings.stats.events || settings.stats.public || settings.stats.revenue || settings.stats.approval)"
                    class="relative z-30 -mt-20 px-6">
                    <div class="max-w-7xl mx-auto flex flex-wrap justify-center gap-6">
                        <div v-if="settings.stats.events"
                            class="w-[calc(50%-0.75rem)] md:w-64 bg-white p-6 rounded-[2rem] shadow-xl border border-brand-100 text-center group hover:-translate-y-2 transition-transform duration-300">
                            <div
                                class="w-12 h-12 bg-primary-light text-primary rounded-xl flex items-center justify-center mx-auto mb-3 group-hover:bg-primary group-hover:text-white transition-colors">
                                <base-icon name="calendar" icon-class="w-6 h-6"></base-icon>
                            </div>
                            <div v-if="isLoading" class="h-9 w-16 bg-brand-200 rounded animate-pulse mx-auto mb-1">
                            </div>
                            <div v-else class="text-3xl font-bold text-brand-800">{{ stats.totalEvents }}</div>
                            <div class="text-[10px] font-bold text-brand-400 uppercase tracking-widest mt-1">Ações
                                Realizadas</div>
                        </div>
                        <div v-if="settings.stats.public"
                            class="w-[calc(50%-0.75rem)] md:w-64 bg-white p-6 rounded-[2rem] shadow-xl border border-brand-100 text-center group hover:-translate-y-2 transition-transform duration-300 delay-75">
                            <div
                                class="w-12 h-12 bg-success-light text-success rounded-xl flex items-center justify-center mx-auto mb-3 group-hover:bg-success group-hover:text-white transition-colors">
                                <base-icon name="users" icon-class="w-6 h-6"></base-icon>
                            </div>
                            <div v-if="isLoading" class="h-9 w-20 bg-brand-200 rounded animate-pulse mx-auto mb-1">
                            </div>
                            <div v-else class="text-3xl font-bold text-brand-800">{{ (stats.totalPublic /
                                1000).toFixed(0) }}
                                mil</div>
                            <div class="text-[10px] font-bold text-brand-400 uppercase tracking-widest mt-1">Mobilização
                                Popular</div>
                        </div>
                        <div v-if="settings.stats.revenue"
                            class="w-[calc(50%-0.75rem)] md:w-64 bg-white p-6 rounded-[2rem] shadow-xl border border-brand-100 text-center group hover:-translate-y-2 transition-transform duration-300 delay-100">
                            <div
                                class="w-12 h-12 bg-warning-light text-warning rounded-xl flex items-center justify-center mx-auto mb-3 group-hover:bg-warning group-hover:text-white transition-colors">
                                <base-icon name="coins" icon-class="w-6 h-6"></base-icon>
                            </div>
                            <div v-if="isLoading" class="h-9 w-24 bg-brand-200 rounded animate-pulse mx-auto mb-1">
                            </div>
                            <div v-else class="text-3xl font-bold text-brand-800">R$ {{ (stats.totalRevenue /
                                1000).toFixed(0)
                                }} mil</div>
                            <div class="text-[10px] font-bold text-brand-400 uppercase tracking-widest mt-1">
                                Retorno e Geração de Renda</div>
                        </div>
                        <div v-show="settings.stats.approval"
                            class="w-[calc(50%-0.75rem)] md:w-64 bg-white p-6 rounded-[2rem] shadow-xl border border-brand-100 text-center group hover:-translate-y-2 transition-transform duration-300 delay-150">
                            <div
                                class="w-12 h-12 bg-primary-light text-primary rounded-xl flex items-center justify-center mx-auto mb-3 group-hover:bg-primary group-hover:text-white transition-colors">
                                <base-icon name="heart" icon-class="w-6 h-6"></base-icon>
                            </div>
                            <!-- Static value doesn't need loading, but added for consistency if it became dynamic later -->
                            <div class="text-3xl font-bold text-brand-800">98%</div>
                            <div class="text-[10px] font-bold text-brand-400 uppercase tracking-widest mt-1">Aprovação
                                Popular</div>
                        </div>
                    </div>
                </div>
        </div>

        <!-- SECTION: PORTFOLIO LIST (LIMITADA PELO ADMIN) -->
        <section id="eventos" :class="settings.portfolio.bgColor" class="py-24" v-if="settings.portfolio.show">
            <div class="max-w-7xl mx-auto px-6">
                <div class="text-center mb-16">
                    <div v-if="settings.portfolio.icon"
                        class="inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-primary-light text-primary mb-6 shadow-sm ring-4 ring-primary-light/50">
                        <base-icon :name="settings.portfolio.icon" icon-class="w-6 h-6"></base-icon>
                    </div>
                    <h2 v-if="settings.portfolio.title" class="text-4xl font-bold text-brand-800 mb-4">{{
                        settings.portfolio.title }}</h2>
                    <p v-if="settings.portfolio.subtitle" class="text-brand-500 font-medium max-w-xl mx-auto text-sm">{{
                        settings.portfolio.subtitle }}</p>
                </div>

                <!-- Painel de Estatísticas Opcional (Toggle no Admin) -->
                <div v-if="settings.portfolio.showStats"
                    class="mb-12 grid grid-cols-2 md:grid-cols-4 gap-6 max-w-5xl mx-auto">
                    <!-- Repetir os cards de estatísticas aqui se desejar duplicar, ou manter apenas no topo -->
                    <!-- Por enquanto manterei o topo como principal -->
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                    <div v-for="event in publicEvents" :key="event.id"
                        class="bg-brand-900 rounded-[2.5rem] overflow-hidden shadow-2xl flex flex-col group hover:-translate-y-2 transition-all duration-500 relative aspect-[4/5] isolate"
                        :class="event.highlight ? 'scale-105 z-10 shadow-[0_25px_60px_-12px_rgba(251,191,36,0.5)] ring-1 ring-white/10' : ''">

                        <!-- Admin Edit Button -->
                        <button v-if="auth.isAuthenticated && ['admin', 'dev'].includes(auth.user?.role)"
                            @click.stop="modal.open('events', event)"
                            class="absolute top-4 right-4 w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white text-white hover:text-primary shadow-lg rounded-full backdrop-blur-md transition-all duration-300 opacity-0 group-hover:opacity-100 z-30"
                            title="Editar Evento">
                            <base-icon name="edit" icon-class="w-5 h-5"></base-icon>
                        </button>

                        <!-- Full Background Image -->
                        <div class="absolute inset-0">
                            <img :src="event.image" loading="lazy"
                                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
                            <!-- Gradient Overlay -->
                            <div class="absolute inset-0 transition-opacity duration-500"
                                :class="event.highlight ? 'bg-gradient-to-t from-amber-950 via-black/60 to-transparent opacity-90 group-hover:opacity-100' : 'bg-gradient-to-t from-black via-black/60 to-transparent opacity-90 group-hover:opacity-100'">
                            </div>
                        </div>

                        <!-- Floating Badges Container -->
                        <div class="absolute top-6 left-6 flex flex-row items-center gap-3 z-20">
                            <!-- Highlight Star (Minimal) -->
                            <div v-if="event.highlight"
                                class="w-8 h-8 rounded-full bg-warning text-warning-light flex items-center justify-center shadow-[0_0_15px_var(--warning)] backdrop-blur-md animate-in zoom-in duration-500">
                                <base-icon name="star" icon-class="w-4 h-4 fill-current"></base-icon>
                            </div>
                            <!-- Porte Badge -->
                            <span
                                class="text-white text-[10px] font-bold uppercase px-4 py-1.5 rounded-full shadow-lg backdrop-blur-md ring-1 ring-white/20 tracking-wider"
                                :class="utils.getBadgeColor(event.porte)">
                                {{ event.porte }}
                            </span>
                        </div>

                        <!-- Content at Bottom -->
                        <div
                            class="absolute bottom-0 left-0 right-0 p-8 flex flex-col z-20 translate-y-2 group-hover:translate-y-0 transition-transform duration-500">

                            <h3 class="text-2xl font-bold mb-4 text-white leading-tight drop-shadow-md">
                                {{ event.title }}
                            </h3>

                            <div
                                class="pt-4 border-t border-white/10 flex justify-between items-center text-brand-300 text-xs font-medium">
                                <div class="flex items-center gap-2">
                                    <div
                                        class="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center backdrop-blur-sm">
                                        <base-icon name="users" icon-class="w-3 h-3 text-primary"></base-icon>
                                    </div>
                                    {{ event.public.toLocaleString() }}
                                </div>
                                <span class="text-primary text-[10px] font-bold uppercase tracking-widest">
                                    {{ formatters.formatDate(event.date) }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- Fecha Grid -->

            <div class="mt-12 w-full flex flex-col items-center gap-6">
                <!-- VIEW ALL (ARQUIVO) -->
                <button v-if="settings.portfolio.viewAllShow && activeEvents.length > settings.portfolio.itemsLimit"
                    @click="router.push('all-events')"
                    class="group inline-flex items-center justify-center gap-3 px-16 py-5 rounded-full bg-primary text-white font-bold uppercase tracking-widest shadow-lg shadow-primary/20 hover:bg-primary-hover hover:shadow-primary/40 hover:-translate-y-1 transition-all duration-300 min-w-[300px]">
                    {{ settings.portfolio.viewAllLabel }}
                    <base-icon name="arrow-right"
                        icon-class="w-5 h-5 group-hover:translate-x-1 transition-transform"></base-icon>
                </button>

                <!-- CTA ADICIONAL -->
                <a :href="settings.portfolio.ctaLink" v-if="settings.portfolio.ctaShow"
                    class="text-primary font-bold uppercase text-[10px] tracking-widest hover:underline flex items-center gap-2 group">
                    {{ settings.portfolio.ctaText }}
                    <base-icon name="arrow-up-right"
                        icon-class="w-4 h-4 group-hover:translate-x-1 group-hover:-translate-y-1 transition-transform"></base-icon>
                </a>
            </div>
        </section> <!-- Fecha #eventos -->

        <!-- SEÇÃO CLIPPING: DESTAQUES MÍDIA (NOVA) -->
        <section v-if="settings.clipping.show && publicClipping.length > 0" :class="settings.clipping.bgColor"
            class="py-24 relative overflow-hidden text-brand-800">
            <!-- Detalhe decorativo de fundo (Apenas se não for fundo branco) -->
            <div v-if="settings.clipping.bgColor !== 'bg-white'"
                class="absolute top-0 right-0 w-64 h-64 bg-brand-50 rounded-full blur-3xl opacity-50 -mr-32 -mt-32 pointer-events-none">
            </div>

            <div class="max-w-7xl mx-auto px-6 relative z-10">
                <div class="flex flex-col md:flex-row justify-between items-end mb-12 gap-6">
                    <div>
                        <div class="flex items-center gap-4 mb-2">
                            <div v-if="settings.clipping.icon"
                                class="inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-warning-light text-warning shadow-sm ring-4 ring-warning-light/50 shrink-0">
                                <base-icon :name="settings.clipping.icon" icon-class="w-6 h-6"></base-icon>
                            </div>
                            <h2 v-if="settings.clipping.title" class="text-4xl font-bold text-brand-800">{{
                                settings.clipping.title }}</h2>
                        </div>
                        <p v-if="settings.clipping.subtitle" class="text-brand-500 text-sm max-w-lg pl-1">{{
                            settings.clipping.subtitle }}</p>
                    </div>

                    <div class="flex flex-col items-end gap-3">
                        <button @click="router.push('clipping')" v-if="settings.clipping.viewAllShow"
                            class="text-primary font-bold uppercase text-[10px] tracking-widest hover:underline flex items-center gap-2 group">
                            {{ settings.clipping.viewAllLabel }} <base-icon name="arrow-right"
                                icon-class="w-4 h-4 group-hover:translate-x-1 transition-transform"></base-icon>
                        </button>
                        <a :href="settings.clipping.ctaLink" v-if="settings.clipping.ctaShow"
                            class="px-6 py-2 rounded-full bg-warning text-warning-light font-bold text-[10px] uppercase tracking-widest shadow-lg hover:scale-105 transition-all">
                            {{ settings.clipping.ctaText }}
                        </a>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div v-for="item in publicClipping.slice(0, settings.clipping.limit)" :key="item.id"
                        class="group flex flex-col sm:flex-row gap-6 rounded-3xl p-5 border transition-all duration-500 relative items-start"
                        :class="item.highlight ? 'bg-gradient-to-br from-warning-light to-white border-warning-light shadow-lg shadow-warning/5' : 'bg-transparent border-transparent hover:bg-white hover:border-brand-100 hover:shadow-xl'">

                        <!-- Admin Edit Button -->
                        <button v-if="auth.isAuthenticated && ['admin', 'dev'].includes(auth.user?.role)"
                            @click.stop="modal.open('clipping', item)"
                            class="absolute top-2 right-2 w-8 h-8 flex items-center justify-center bg-white/50 hover:bg-white text-primary shadow-sm rounded-full backdrop-blur-md transition-all duration-300 opacity-0 group-hover:opacity-100 z-20"
                            title="Editar Matéria">
                            <base-icon name="edit" icon-class="w-4 h-4"></base-icon>
                        </button>

                        <!-- Image Column -->
                        <div
                            class="w-full sm:w-48 h-48 sm:h-32 shrink-0 rounded-2xl overflow-hidden relative shadow-sm group-hover:shadow-md transition-all">
                            <img :src="item.image"
                                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                            <div class="absolute inset-0 bg-black/10 group-hover:bg-transparent transition-colors">
                            </div>
                        </div>

                        <!-- Content Column -->
                        <div class="flex-1 flex flex-col h-full justify-center">
                            <div class="flex items-center gap-2 mb-2">
                                <span v-if="item.highlight"
                                    class="bg-warning-light text-warning text-[10px] font-bold px-2 py-0.5 rounded-full border border-warning-light uppercase tracking-wider flex items-center gap-1">
                                    <base-icon name="star" icon-class="w-3 h-3 text-warning fill-warning"></base-icon>
                                    Destaque
                                </span>
                                <span v-else class="w-1.5 h-1.5 rounded-full bg-primary"></span>
                                <span class="text-[10px] font-bold uppercase text-brand-400 tracking-wider">{{
                                    item.source }}</span>
                            </div>

                            <h3 class="font-bold text-lg text-brand-800 leading-snug mb-3 group-hover:text-primary transition-colors line-clamp-2"
                                :title="item.title">
                                {{ item.title }}
                            </h3>

                            <div
                                class="flex justify-between items-center mt-auto pt-2 border-t border-brand-200/50 w-full">
                                <span class="text-[11px] text-brand-400 font-medium">{{ formatters.formatDate(item.date)
                                    }}</span>
                                <a :href="item.url" target="_blank"
                                    class="text-primary hover:text-primary-hover transition-colors flex items-center gap-1 text-[11px] font-bold uppercase tracking-wide">
                                    Ler mais <base-icon name="arrow-up-right" icon-class="w-3 h-3"></base-icon>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: DEPOIMENTOS -->
        <section id="depoimentos" :class="settings.testimonials.bgColor" class="py-24"
            v-if="settings.testimonials.show && publicTestimonials.length > 0">
            <div class="max-w-7xl mx-auto px-6">
                <div class="text-center mb-16">
                    <div v-if="settings.testimonials.icon"
                        class="inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-primary text-white mb-6 shadow-lg border border-primary-light/20 shadow-primary/20">
                        <base-icon :name="settings.testimonials.icon" icon-class="w-6 h-6"></base-icon>
                    </div>
                    <h2 v-if="settings.testimonials.title" class="text-4xl font-bold mb-4"
                        :class="settings.testimonials.bgColor === 'bg-brand-900' ? 'text-white' : 'text-brand-800'">
                        {{ settings.testimonials.title }}
                    </h2>
                    <p v-if="settings.testimonials.subtitle" class="font-medium max-w-xl mx-auto text-sm"
                        :class="settings.testimonials.bgColor === 'bg-brand-900' ? 'text-brand-200' : 'text-brand-500'">
                        {{ settings.testimonials.subtitle }}
                    </p>
                </div>
                <!-- Grid de Depoimentos (Limitado) -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div v-for="t in publicTestimonials.slice(0, settings.testimonials.itemsLimit)" :key="t.id"
                        class="backdrop-blur-md p-8 rounded-[2rem] border relative group transition-all duration-500 flex flex-col h-full"
                        :class="[
                            t.highlight ? 'bg-gradient-to-br from-brand-900 via-brand-900 to-warning/40 border-warning shadow-2xl shadow-warning-light/10 text-warning-light ring-1 ring-warning/20' : 'bg-brand-50/50 border-brand-100 text-brand-600 hover:bg-white hover:shadow-xl',
                            settings.testimonials.bgColor === 'bg-brand-900' && !t.highlight ? 'bg-brand-800/50 border-brand-700/50 text-brand-100 hover:bg-brand-800' : ''
                        ]">

                        <base-icon name="quote"
                            :class="t.highlight ? 'text-warning opacity-100 scale-110 drop-shadow-[0_0_8px_rgba(251,191,36,0.3)]' : 'text-primary/30'"
                            icon-class="w-10 h-10 absolute top-6 right-6 transition-all duration-500"></base-icon>
                        <div class="flex items-center gap-4 mb-6">
                            <div
                                class="w-12 h-12 rounded-full bg-primary flex items-center justify-center font-bold text-white text-lg overflow-hidden border-2 border-primary-light/30">
                                <img v-if="t.photo" :src="t.photo" class="w-full h-full object-cover">
                                <span v-else>{{ t.author.charAt(0) }}</span>
                            </div>
                            <div>
                                <div class="font-bold text-white">{{ t.author }}</div>
                                <div class="text-[10px] uppercase tracking-widest text-brand-300">{{ t.role }}
                                </div>
                            </div>
                        </div>

                        <!-- VIDEO TYPE -->
                        <div v-if="t.type === 'video' && utils.getYoutubeId(t.videoUrl)"
                            class="rounded-2xl overflow-hidden relative group/video cursor-pointer aspect-video mb-4"
                            @click="mediaModal.open('video', t.videoUrl, t.author + ' - ' + t.role)">
                            <img :src="'https://img.youtube.com/vi/' + utils.getYoutubeId(t.videoUrl) + '/mqdefault.jpg'"
                                class="w-full h-full object-cover group-hover/video:scale-105 transition duration-500">
                            <div
                                class="absolute inset-0 bg-black/30 group-hover/video:bg-black/40 transition flex items-center justify-center">
                                <div
                                    class="w-12 h-12 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center text-white group-hover/video:scale-110 transition">
                                    <base-icon name="play" icon-class="w-5 h-5 fill-current ml-1"></base-icon>
                                </div>
                            </div>
                        </div>

                        <!-- IMAGE TYPE -->
                        <div v-else-if="t.type === 'imagem' && utils.isValidUrl(t.imageUrl)"
                            class="rounded-2xl overflow-hidden mb-4 border border-primary-light/30 cursor-pointer"
                            @click="mediaModal.open('image', t.imageUrl, t.author + ' - ' + t.role)">
                            <img :src="utils.resolveImageUrl(t.imageUrl)"
                                class="w-full h-48 object-cover hover:scale-105 transition duration-500">
                        </div>

                        <p :class="utils.getTestimonialStyle(t)">"{{ t.text }}"</p>
                        <div class="mt-6 flex items-center gap-2 text-[10px] font-bold uppercase text-primary"
                            v-if="t.context === 'evento'">
                            <base-icon name="map-pin" icon-class="w-3 h-3"></base-icon>
                            {{ t.eventName }}
                        </div>
                    </div>
                </div>
                <!-- Footer da Seção -->
                <div class="mt-12 flex justify-center gap-6"
                    v-if="settings.testimonials.ctaShow || settings.testimonials.viewAllShow">
                    <button v-if="settings.testimonials.ctaShow" @click="ui.scrollTo('#contato')"
                        class="px-8 py-3 rounded-full bg-primary text-white font-bold uppercase tracking-widest shadow-lg hover:scale-105 transition-all">
                        {{ settings.testimonials.ctaText }}
                    </button>
                    <button v-if="settings.testimonials.viewAllShow" @click="router.push('all-testimonials')"
                        class="text-primary font-bold uppercase text-[10px] tracking-widest hover:underline flex items-center gap-2 group">
                        {{ settings.testimonials.viewAllLabel }} <base-icon name="arrow-right"
                            icon-class="w-4 h-4 group-hover:translate-x-1 transition-transform"></base-icon>
                    </button>
                </div>
            </div>
        </section>

        <!-- SECTION: TEAM (PUBLIC) -->
        <section :class="settings.team.bgColor" class="py-24 relative overflow-hidden" v-if="settings.team.show">
            <div
                class="absolute top-0 left-0 w-full h-px bg-gradient-to-r from-transparent via-brand-200 to-transparent">
            </div>
            <div class="max-w-7xl mx-auto px-6">
                <div class="text-center mb-16">
                    <div v-if="settings.team.icon"
                        class="inline-flex items-center justify-center w-12 h-12 rounded-2xl bg-success-light text-success mb-6 shadow-sm ring-4 ring-success-light/50">
                        <base-icon :name="settings.team.icon" icon-class="w-6 h-6"></base-icon>
                    </div>
                    <h2 v-if="settings.team.title" class="text-4xl font-bold text-brand-800 mb-4">{{ settings.team.title
                        }}</h2>
                    <p v-if="settings.team.subtitle" class="text-brand-500 font-medium max-w-xl mx-auto text-sm">{{
                        settings.team.subtitle }}</p>
                </div>

                <div class="flex flex-wrap justify-center gap-8">
                    <div v-for="member in publicTeam.slice(0, settings.team.itemsLimit).sort((a, b) => (b.highlight === true) - (a.highlight === true))"
                        :key="member.id"
                        class="group text-center w-full md:w-[calc(50%-1rem)] lg:w-[calc(25%-1.5rem)] min-w-[200px] relative hover:bg-brand-50/50 rounded-3xl p-4 transition-colors duration-300">
                        <!-- Admin Edit Button -->
                        <button v-if="auth.isAuthenticated && ['admin', 'dev'].includes(auth.user?.role)"
                            @click.stop="modal.open('team', member)"
                            class="absolute top-2 right-2 w-8 h-8 flex items-center justify-center bg-primary/10 hover:bg-primary text-primary hover:text-white rounded-full transition-all duration-300 opacity-0 group-hover:opacity-100 z-20"
                            title="Editar Membro">
                            <base-icon name="edit" icon-class="w-4 h-4"></base-icon>
                        </button>

                        <!-- Avatar -->
                        <div class="relative w-40 h-40 mx-auto mb-6 rounded-full p-1 transition-all duration-500"
                            :class="member.highlight 
                                ? 'bg-gradient-to-tr from-warning via-warning to-warning shadow-xl shadow-warning-light/50 scale-105' 
                                : 'border-2 border-dashed border-brand-200 group-hover:border-primary'">

                            <!-- Inner Ring for clean separation -->
                            <div class="w-full h-full rounded-full overflow-hidden relative"
                                :class="member.highlight ? 'border-4 border-white' : ''">
                                <img :src="member.photo || 'https://images.unsplash.com/photo-1492684223066-81342ee5ff30'"
                                    class="w-full h-full object-cover transition-all duration-500 transform group-hover:scale-110"
                                    :class="member.highlight ? '' : 'filter grayscale group-hover:grayscale-0'">
                            </div>
                        </div>

                        <!-- Name -->
                        <h3 class="text-lg font-bold text-brand-800 mb-1 group-hover:text-primary transition-colors">
                            {{ member.name }}
                        </h3>
                        <p class="text-xs font-bold uppercase tracking-widest text-brand-400 mb-3">{{
                            member.position }}</p>
                        <p
                            class="text-sm text-brand-500 leading-relaxed max-w-xs mx-auto opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            {{ member.bio }}
                        </p>
                    </div>
                </div>
                <!-- Footer da Seção Equipe -->
                <div class="mt-12 flex justify-center gap-6" v-if="settings.team.ctaShow || settings.team.viewAllShow">
                    <a :href="settings.team.ctaLink" v-if="settings.team.ctaShow"
                        class="px-8 py-3 rounded-full bg-primary text-white font-bold uppercase tracking-widest shadow-lg hover:scale-105 transition-all">
                        {{ settings.team.ctaText }}
                    </a>
                </div>
            </div>
        </section>

        <!-- SECTION: DIVISOR PARALLAX (CONFIGURÁVEL) -->
        <section v-if="settings.parallax.show"
            class="relative py-32 bg-fixed bg-cover bg-center flex items-center justify-center text-center text-white before:content-[''] before:absolute before:inset-0 before:bg-brand-900/60"
            :style="{ backgroundImage: `url('${settings.parallax.image}')` }">
            <div class="relative z-10 max-w-3xl px-6 animate-in fade-in slide-in-from-bottom-8 duration-1000">
                <h2 class="text-4xl md:text-5xl font-bold mb-6 tracking-tight">{{ settings.parallax.title }}
                </h2>
                <p class="text-lg md:text-xl text-brand-200 font-light">{{ settings.parallax.subtitle }}</p>
            </div>
        </section>

        <footer v-if="settings.footer.show"
            class="bg-brand-900 text-brand-400 py-12 text-center text-sm border-t border-brand-800 relative z-10">
            <div class="mb-6 flex justify-center gap-4 flex-wrap">
                <a v-for="(link, idx) in settings.footer.links" :key="idx" :href="link.url" target="_blank"
                    class="w-10 h-10 rounded-full bg-brand-800 flex items-center justify-center hover:bg-primary hover:text-white transition-all group relative">
                    <base-icon :name="link.icon || 'link'" icon-class="w-5 h-5"></base-icon>

                    <!-- Tooltip -->
                    <span
                        class="absolute -top-10 scale-0 group-hover:scale-100 transition-transform bg-brand-800 text-white text-[10px] font-bold py-1 px-3 rounded-lg shadow-xl whitespace-nowrap pointer-events-none border border-brand-700">
                        {{ link.label }}
                    </span>
                </a>
            </div>
            <p class="opacity-50 px-4">{{ settings.footer.text }}</p>
        </footer>
        </template>

        <!-- CONTEXTO: VIEW ALL EVENTS (ARQUIVO PÚBLICO) -->
        <base-public-archive v-if="router.current === 'all-events'" title="Arquivo de Eventos" :items="filteredEvents"
            :schema="{ collection: 'events', icon: 'calendar-off' }" :model-search="eventSearch"
            :model-sort="eventSortBy" @update:search="eventSearch = $event" @update:sort-by="eventSortBy = $event"
            search-placeholder="Buscar eventos..." back-label="Voltar para Início"
            empty-message="Nenhum evento encontrado." @back="router.push('dashboard')">
        </base-public-archive>

        <!-- CONTEXTO: CLIPPING COMPLETE VIEW -->
        <base-public-archive v-if="router.current === 'clipping'" title="Clipping na Mídia" :items="filteredClipping"
            :schema="{ collection: 'clipping', icon: 'newspaper' }" :model-search="clippingSearch"
            :model-sort="clippingSortBy" @update:search="clippingSearch = $event"
            @update:sort-by="clippingSortBy = $event" search-placeholder="Buscar notícias..."
            back-label="Voltar para Início" empty-message="Nenhuma matéria encontrada."
            @back="router.push('dashboard')">
        </base-public-archive>
    </div>

    <!-- CONTEXTO: ADMIN PANEL -->
    <div v-else-if="router.currentContext === 'admin' && auth.isAuthenticated" class="min-h-screen">
        <!-- SIDEBAR -->
        <aside
            class="sidebar bg-brand-900 text-white h-screen flex flex-col fixed left-0 top-0 bottom-0 border-r border-brand-800"
            :class="{ 'collapsed': !ui.isSidebarOpen }">
            <div
                class="sidebar-header p-6 flex items-center gap-3 border-b border-brand-800 h-20 transition-all duration-300">
                <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center shrink-0">
                    <base-icon name="command" icon-class="w-5 h-5 text-white"></base-icon>
                </div>
                <span class="font-bold text-lg tracking-tight branding-text whitespace-nowrap overflow-hidden">Gestor
                    Pro</span>
                <button @click="ui.isSidebarOpen = !ui.isSidebarOpen"
                    class="ml-auto text-brand-500 hover:text-white md:hidden">
                    <base-icon name="x" icon-class="w-5 h-5"></base-icon>
                </button>
            </div>

            <nav class="flex-1 py-6 px-3 space-y-1 overflow-y-auto custom-scrollbar min-h-0">
                <!-- VIEW SITE (Sleek Integrated Style) -->
                <button @click="navContext('public')"
                    class="w-full flex items-center gap-3 px-3 py-3 rounded-xl text-primary bg-primary-light/5 hover:bg-primary/20 transition-all group mb-4">
                    <base-icon name="external-link"
                        icon-class="w-5 h-5 group-hover:scale-110 transition-transform"></base-icon>
                    <span class="font-bold text-sm nav-label">Ver Site</span>
                </button>

                <!-- SEÇÃO 1: GERENCIAMENTO (Comum) -->
                <div class="text-[10px] font-bold text-brand-500 uppercase tracking-widest px-3 mb-2 nav-label">
                    Gerenciamento</div>

                <!-- DEBUG INFO -->
                <div class="text-[9px] text-danger bg-danger-light p-2 rounded mx-3 mb-2">
                    <div>Role: {{ auth.user?.role }}</div>
                    <div>manage_events: {{ can('manage_events') }}</div>
                    <div>manage_users: {{ can('manage_users') }}</div>
                </div>

                <button @click="nav('dashboard')"
                    :class="router.current === 'dashboard' ? 'bg-primary/10 text-primary' : 'text-brand-400 hover:bg-brand-800 hover:text-white'"
                    class="w-full flex items-center gap-3 px-3 py-3 rounded-xl transition-all group mb-1">
                    <base-icon name="layout-dashboard"
                        icon-class="w-5 h-5 group-hover:scale-110 transition-transform"></base-icon>
                    <span class="font-medium text-sm nav-label">Visão Geral</span>
                </button>

                <!-- SECTION DIVIDER -->
                <div v-if="can('manage_events')" class="h-px bg-brand-600/40 mx-3 my-6"></div>

                <button v-if="can('manage_events')" @click="nav('events')"
                    :class="router.current === 'events' ? 'bg-primary/10 text-primary' : 'text-brand-400 hover:bg-brand-800 hover:text-white'"
                    class="w-full flex items-center gap-3 px-3 py-3 rounded-xl transition-all group mb-1">
                    <base-icon name="calendar"
                        icon-class="w-5 h-5 group-hover:scale-110 transition-transform"></base-icon>
                    <span class="font-medium text-sm nav-label">Eventos</span>
                </button>

                <button v-if="can('manage_events')" @click="nav('testimonials')"
                    :class="router.current === 'testimonials' ? 'bg-primary/10 text-primary' : 'text-brand-400 hover:bg-brand-800 hover:text-white'"
                    class="w-full flex items-center gap-3 px-3 py-3 rounded-xl transition-all group mb-1">
                    <base-icon name="message-square"
                        icon-class="w-5 h-5 group-hover:scale-110 transition-transform"></base-icon>
                    <span class="font-medium text-sm nav-label">Depoimentos</span>
                </button>

                <button v-if="can('manage_events')" @click="nav('clipping')"
                    :class="router.current === 'clipping' ? 'bg-primary/10 text-primary' : 'text-brand-400 hover:bg-brand-800 hover:text-white'"
                    class="w-full flex items-center gap-3 px-3 py-3 rounded-xl transition-all group mb-1">
                    <base-icon name="newspaper"
                        icon-class="w-5 h-5 group-hover:scale-110 transition-transform"></base-icon>
                    <span class="font-medium text-sm nav-label">Clipping</span>
                </button>

                <button v-if="can('manage_events')" @click="nav('team')"
                    :class="router.current === 'team' ? 'bg-primary/10 text-primary' : 'text-brand-400 hover:bg-brand-800 hover:text-white'"
                    class="w-full flex items-center gap-3 px-3 py-3 rounded-xl transition-all group mb-1">
                    <base-icon name="briefcase"
                        icon-class="w-5 h-5 group-hover:scale-110 transition-transform"></base-icon>
                    <span class="font-medium text-sm nav-label">Equipe</span>
                </button>

                <!-- SECTION: OSCs -->
                <button v-if="can('manage_events')" @click="nav('oscs')"
                    :class="router.current === 'oscs' ? 'bg-primary/10 text-primary' : 'text-brand-400 hover:bg-brand-800 hover:text-white'"
                    class="w-full flex items-center gap-3 px-3 py-3 rounded-xl transition-all group mb-1">
                    <base-icon name="building-2"
                        icon-class="w-5 h-5 group-hover:scale-110 transition-transform"></base-icon>
                    <span class="font-medium text-sm nav-label">OSCs</span>
                </button>

                <!-- SECTION DIVIDER -->
                <div v-if="can('manage_events')" class="h-px bg-brand-600/40 mx-3 my-6"></div>

                <!-- SEÇÃO: DOCUMENTOS -->
                <div v-if="can('manage_events')"
                    class="text-[10px] font-bold text-brand-500 uppercase tracking-widest px-3 mb-2 nav-label">
                    Documentos</div>

                <button v-if="can('manage_events')" @click="nav('documents')"
                    :class="router.current === 'documents' ? 'bg-primary/10 text-primary' : 'text-brand-400 hover:bg-brand-800 hover:text-white'"
                    class="w-full flex items-center gap-3 px-3 py-3 rounded-xl transition-all group mb-1">
                    <base-icon name="file-text"
                        icon-class="w-5 h-5 group-hover:scale-110 transition-transform"></base-icon>
                    <span class="font-medium text-sm nav-label">Gerador de PDF</span>
                </button>

                <!-- SECTION DIVIDER -->
                <div v-if="can('manage_events')" class="h-px bg-brand-600/40 mx-3 my-6"></div>

                <!-- SEÇÃO: CONFIGURAÇÕES (Landing Page) -->
                <div v-if="can('manage_events')"
                    class="text-[10px] font-bold text-brand-500 uppercase tracking-widest px-3 mb-2 nav-label">
                    Configurações</div>

                <button v-if="can('manage_events')" @click="nav('settings')"
                    :class="router.current === 'settings' ? 'bg-primary/10 text-primary' : 'text-brand-400 hover:bg-brand-800 hover:text-white'"
                    class="w-full flex items-center gap-3 px-3 py-3 rounded-xl transition-all group mb-1">
                    <base-icon name="settings" icon-class="w-5 h-5 group-hover:spin-slow"></base-icon>
                    <span class="font-medium text-sm nav-label">Landing Page</span>
                </button>

                <!-- SECTION DIVIDER -->
                <div v-if="can('manage_users')" class="h-px bg-brand-600/40 mx-3 my-6"></div>

                <!-- SEÇÃO: ADMINISTRAÇÃO (Sistema - Controle de Acesso) -->
                <div v-if="can('manage_users')"
                    class="text-[10px] font-bold text-brand-500 uppercase tracking-widest px-3 mb-2 nav-label">
                    Administração</div>

                <button v-if="can('manage_users')" @click="nav('users')"
                    :class="router.current === 'users' ? 'bg-primary/10 text-primary' : 'text-brand-400 hover:bg-brand-800 hover:text-white'"
                    class="w-full flex items-center gap-3 px-3 py-3 rounded-xl transition-all group mb-1">
                    <base-icon name="users" icon-class="w-5 h-5 group-hover:scale-110 transition-transform"></base-icon>
                    <span class="font-medium text-sm nav-label">Usuários</span>
                </button>

                <!-- SECTION DIVIDER -->
                <div v-if="can('view_dev_tools')" class="h-px bg-brand-600/40 mx-3 my-6"></div>

                <!-- SEÇÃO: DESENVOLVEDOR -->
                <div v-if="can('view_dev_tools')"
                    class="text-[10px] font-bold text-brand-500 uppercase tracking-widest px-3 mb-2 nav-label">
                    Desenvolvedor</div>

                <button v-if="can('view_dev_tools')" @click="nav('dev')"
                    :class="router.current === 'dev' ? 'bg-primary/10 text-primary' : 'text-brand-400 hover:bg-brand-800 hover:text-white'"
                    class="w-full flex items-center gap-3 px-3 py-3 rounded-xl transition-all group mb-1">
                    <base-icon name="cpu" icon-class="w-5 h-5 group-hover:spin-slow"></base-icon>
                    <span class="font-medium text-sm nav-label">Dev Tools</span>
                </button>
            </nav>

            <div class="sidebar-footer p-6 border-t border-brand-800 transition-all duration-300">
                <button @click="auth.logout(); ui.isSidebarOpen = false"
                    class="w-full flex items-center gap-3 px-3 py-3 rounded-xl text-danger hover:bg-danger-light transition-all">
                    <base-icon name="log-out" icon-class="w-5 h-5"></base-icon>
                    <span class="font-medium text-sm nav-label">Sair</span>
                </button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="bg-brand-50 min-h-screen transition-all duration-300"
            :class="{ 'lg:ml-[4.5rem]': !ui.isSidebarOpen, 'lg:ml-64': ui.isSidebarOpen }">
            <!-- HEADER -->
            <header v-show="!ui.hideHeader"
                class="bg-white border-b border-brand-100 h-20 px-4 md:px-8 flex items-center justify-between sticky top-0 transition-all duration-300 bg-white/80 backdrop-blur-md"
                :class="ui.userMenuOpen ? 'z-[10001]' : 'z-40'">
                <div class="flex items-center gap-4">
                    <button @click="ui.isSidebarOpen = !ui.isSidebarOpen"
                        class="w-10 h-10 rounded-xl hover:bg-brand-50 flex items-center justify-center text-brand-500 transition-colors">
                        <base-icon name="menu" icon-class="w-6 h-6"></base-icon>
                    </button>
                    <h2 class="text-xl font-bold text-brand-800">{{ pageTitle }}</h2>
                </div>

                <div class="flex items-center gap-6">
                    <button
                        class="relative w-10 h-10 rounded-xl hover:bg-brand-50 flex items-center justify-center text-brand-400 transition-colors">
                        <base-icon name="bell" icon-class="w-5 h-5"></base-icon>
                        <span class="absolute top-2 right-2 w-2 h-2 bg-danger rounded-full border border-white"></span>
                    </button>
                    <div class="flex items-center gap-3 pl-6 border-l border-brand-100 relative">
                        <div class="text-right hidden md:block">
                            <div class="text-sm font-bold text-brand-800">{{ auth.user?.name }}</div>
                            <div class="text-[10px] font-bold text-brand-400">{{ auth.user?.email }}</div>
                        </div>

                        <!-- AVATAR & MENU TRIGGER -->
                        <div @click="ui.userMenuOpen = !ui.userMenuOpen"
                            class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center font-bold shadow-lg shadow-primary-light/20 overflow-hidden text-sm cursor-pointer hover:shadow-primary/30 transition-all active:scale-95 ring-2 ring-transparent hover:ring-brand-100">
                            <img v-if="auth.user?.photo" :src="auth.user.photo" class="w-full h-full object-cover">
                            <span v-else>{{ auth.user?.name?.charAt(0) || '?' }}</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- ADMIN USER MENU (Componente específico do admin) -->
            <admin-user-menu v-if="auth.isAuthenticated && auth.user" :show="ui.userMenuOpen" :user="auth.user"
                :current-context="router.currentContext" :is-compact-mode="settings.isCompactMode"
                @close="ui.userMenuOpen = false" @navigate-context="navContext"
                @open-profile="modal.open('users', auth.user); ui.userMenuOpen = false"
                @toggle-compact="settings.isCompactMode = !settings.isCompactMode"
                @logout="auth.logout(); ui.userMenuOpen = false">
            </admin-user-menu>

            <!-- MAINTENANCE ALERT BANNER -->
            <div v-if="settings.isMaintenance"
                class="bg-warning-light border-b border-warning-light px-8 py-3 flex items-center justify-center gap-3 text-warning animate-in slide-in-from-top duration-300 sticky top-20 z-30">
                <base-icon name="alert-triangle" icon-class="w-5 h-5 animate-pulse"></base-icon>
                <div class="flex flex-col md:flex-row items-center gap-1 md:gap-3 text-center">
                    <span class="font-bold text-sm uppercase tracking-wide">Modo de Manutenção Ativo</span>
                    <span class="text-xs opacity-75 hidden md:inline">• O acesso público está bloqueado</span>
                </div>
            </div>

            <!-- CONTENT ADMIN -->
            <div class="p-4 md:p-8">
                <div v-if="router.current === 'dashboard'"
                    class="max-w-6xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <!-- Stats Overview -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-[2rem] border border-brand-100 shadow-sm flex items-center gap-4 transition-all"
                            :class="{ 'card-processing': isLoading }">
                            <div
                                class="w-12 h-12 rounded-2xl bg-primary-light text-primary flex items-center justify-center">
                                <base-icon name="calendar" icon-class="w-6 h-6"></base-icon>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-brand-800">{{ activeEvents.length }}</div>
                                <div class="text-xs font-bold text-brand-400 uppercase">Eventos Ativos</div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-[2rem] border border-brand-100 shadow-sm flex items-center gap-4 transition-all"
                            :class="{ 'card-processing': isLoading }">
                            <div
                                class="w-12 h-12 rounded-2xl bg-success-light text-success flex items-center justify-center">
                                <base-icon name="users" icon-class="w-6 h-6"></base-icon>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-brand-800">{{ (stats.totalPublic /
                                    1000).toFixed(1) }}k</div>
                                <div class="text-xs font-bold text-brand-400 uppercase">Público Total</div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-[2rem] border border-brand-100 shadow-sm flex items-center gap-4 transition-all"
                            :class="{ 'card-processing': isLoading }">
                            <div
                                class="w-12 h-12 rounded-2xl bg-warning-light text-warning flex items-center justify-center">
                                <base-icon name="coins" icon-class="w-6 h-6"></base-icon>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-brand-800">R$ {{ (stats.totalRevenue /
                                    1000).toFixed(0) }}k</div>
                                <div class="text-xs font-bold text-brand-400 uppercase">Receita Est.</div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-[2rem] border border-brand-100 shadow-sm flex items-center gap-4 transition-all"
                            :class="{ 'card-processing': isLoading }">
                            <div
                                class="w-12 h-12 rounded-2xl bg-primary-light text-primary flex items-center justify-center">
                                <base-icon name="newspaper" icon-class="w-6 h-6"></base-icon>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-brand-800">{{ publicClipping.length }}</div>
                                <div class="text-xs font-bold text-brand-400 uppercase">Clipping</div>
                            </div>
                        </div>
                    </div>

                    <!-- System Health Header (NEW) -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-4 rounded-3xl border border-brand-100 shadow-sm flex items-center justify-between group transition-all"
                            :class="{ 'card-processing': isLoading }">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 rounded-xl bg-success-light text-success flex items-center justify-center">
                                    <base-icon name="database" icon-class="w-5 h-5"></base-icon>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-brand-400 uppercase tracking-widest">Planilha
                                        Google</div>
                                    <div class="text-sm font-bold text-brand-800 flex items-center gap-2">
                                        Database
                                        <a :href="systemInfo.database.url" target="_blank"
                                            class="opacity-0 group-hover:opacity-100 transition-opacity text-primary">
                                            <base-icon name="external-link" icon-class="w-3 h-3"></base-icon>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-[10px] font-bold"
                                    :class="systemInfo.database.status === 'connected' ? 'text-success' : 'text-danger'">
                                    {{ systemInfo.database.status === 'connected' ? 'ONLINE' : 'ERRO' }}
                                </span>
                                <span class="flex h-2.5 w-2.5 relative">
                                    <span
                                        class="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75"
                                        :class="systemInfo.database.status === 'connected' ? 'bg-success' : 'bg-danger'"></span>
                                    <span class="relative inline-flex rounded-full h-2.5 w-2.5"
                                        :class="systemInfo.database.status === 'connected' ? 'bg-success' : 'bg-danger'"></span>
                                </span>
                            </div>
                        </div>

                        <div class="bg-white p-4 rounded-3xl border border-brand-100 shadow-sm flex items-center justify-between group transition-all"
                            :class="{ 'card-processing': isLoading }">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 rounded-xl bg-primary-light text-primary flex items-center justify-center">
                                    <base-icon name="folder" icon-class="w-5 h-5"></base-icon>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-brand-400 uppercase tracking-widest">Google
                                        Drive</div>
                                    <div class="text-sm font-bold text-brand-800 flex items-center gap-2">
                                        Assets Storage
                                        <a :href="systemInfo.drive.url" target="_blank"
                                            class="opacity-0 group-hover:opacity-100 transition-opacity text-primary">
                                            <base-icon name="external-link" icon-class="w-3 h-3"></base-icon>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-[10px] font-bold"
                                    :class="systemInfo.drive.status === 'connected' ? 'text-success' : 'text-danger'">
                                    {{ systemInfo.drive.status === 'connected' ? 'ONLINE' : 'ERRO' }}
                                </span>
                                <span class="flex h-2.5 w-2.5 relative">
                                    <span
                                        class="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75"
                                        :class="systemInfo.drive.status === 'connected' ? 'bg-success' : 'bg-danger'"></span>
                                    <span class="relative inline-flex rounded-full h-2.5 w-2.5"
                                        :class="systemInfo.drive.status === 'connected' ? 'bg-success' : 'bg-danger'"></span>
                                </span>
                            </div>
                        </div>

                        <div class="bg-white p-4 rounded-3xl border border-brand-100 shadow-sm flex items-center justify-between transition-all"
                            :class="{ 'card-processing': isLoading }">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 rounded-xl bg-warning-light text-warning flex items-center justify-center">
                                    <base-icon name="activity" icon-class="w-5 h-5"></base-icon>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-brand-400 uppercase tracking-widest">Status
                                        da API</div>
                                    <div class="text-sm font-bold text-brand-800">Cultura Viva v2.0</div>
                                </div>
                            </div>
                            <button @click="dataActions.refresh" :disabled="isLoading"
                                class="p-2 hover:bg-brand-50 rounded-xl text-brand-400 transition-all active:scale-95 disabled:opacity-50"
                                title="Atualizar dados e status">
                                <base-icon name="refresh-cw" icon-class="w-4 h-4"
                                    :class="isLoading ? 'animate-spin' : ''"></base-icon>
                            </button>
                        </div>
                    </div>

                    <!-- Quick Actions & Recent Events -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-8">
                        <!-- Quick Actions -->
                        <div class="bg-white rounded-[2rem] border border-brand-100 shadow-sm p-6 transition-all"
                            :class="{ 'card-processing': isLoading }">
                            <h3 class="text-lg font-bold text-brand-800 mb-4 flex items-center gap-2">
                                <base-icon name="zap" icon-class="w-5 h-5 text-primary"></base-icon>
                                Ações Rápidas
                            </h3>
                            <div class="space-y-2">
                                <button @click="modal.open('events')" :disabled="isLoading"
                                    class="w-full text-left px-4 py-3 rounded-xl hover:bg-brand-50 text-brand-600 font-bold text-sm flex items-center gap-3 transition-colors disabled:opacity-50">
                                    <base-icon name="plus-circle" icon-class="w-4 h-4 text-primary"></base-icon>
                                    Novo Evento
                                </button>
                                <button @click="modal.open('users')" :disabled="isLoading"
                                    class="w-full text-left px-4 py-3 rounded-xl hover:bg-brand-50 text-brand-600 font-bold text-sm flex items-center gap-3 transition-colors disabled:opacity-50">
                                    <base-icon name="user-plus" icon-class="w-4 h-4 text-success"></base-icon>
                                    Novo Usuário
                                </button>
                                <button @click="modal.open('clipping')" :disabled="isLoading"
                                    class="w-full text-left px-4 py-3 rounded-xl hover:bg-brand-50 text-brand-600 font-bold text-sm flex items-center gap-3 transition-colors disabled:opacity-50">
                                    <base-icon name="newspaper" icon-class="w-4 h-4 text-warning"></base-icon>
                                    Novo Clipping
                                </button>
                                <button @click="router.push('settings')" :disabled="isLoading"
                                    class="w-full text-left px-4 py-3 rounded-xl hover:bg-brand-50 text-brand-600 font-bold text-sm flex items-center gap-3 transition-colors disabled:opacity-50">
                                    <base-icon name="settings" icon-class="w-4 h-4 text-brand-400"></base-icon>
                                    Configurações
                                </button>
                            </div>
                        </div>

                        <!-- Recent Events -->
                        <div class="lg:col-span-2 bg-white rounded-[2rem] border border-brand-100 shadow-sm p-6 transition-all"
                            :class="{ 'card-processing': isLoading }">
                            <h3 class="text-lg font-bold text-brand-800 mb-4 flex items-center gap-2">
                                <base-icon name="calendar" icon-class="w-5 h-5 text-primary"></base-icon>
                                Eventos Recentes
                            </h3>
                            <div v-if="activeEvents.length > 0" class="space-y-3">
                                <div v-for="event in activeEvents.slice(0, 3)" :key="event.id"
                                    @click="!isLoading && modal.open('events', event)"
                                    class="flex items-center gap-4 p-3 rounded-xl hover:bg-brand-50 transition-colors"
                                    :class="isLoading ? 'cursor-not-allowed opacity-50' : 'cursor-pointer'">
                                    <div class="w-12 h-12 rounded-xl overflow-hidden shrink-0 bg-brand-100">
                                        <img v-if="event.image" :src="event.image" class="w-full h-full object-cover">
                                        <div v-else
                                            class="w-full h-full flex items-center justify-center text-brand-400">
                                            <base-icon name="calendar" icon-class="w-6 h-6"></base-icon>
                                        </div>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="text-sm font-bold text-brand-800 truncate">{{ event.title }}</div>
                                        <div class="text-xs text-brand-400 font-medium">{{
                                            formatters.formatDate(event.date) }}
                                        </div>
                                    </div>
                                    <div class="text-xs font-bold text-primary px-3 py-1 rounded-lg bg-primary-light">
                                        {{ event.porte || 'Local' }}
                                    </div>
                                </div>
                            </div>
                            <div v-else class="text-center py-8 text-brand-400">
                                <base-icon name="calendar-x" icon-class="w-12 h-12 mx-auto mb-2 opacity-50"></base-icon>
                                <p class="text-sm">Nenhum evento encontrado</p>
                            </div>
                        </div>
                    </div>

                    <!-- Users Overview -->
                    <div class="bg-white rounded-[2rem] border border-brand-100 shadow-sm p-6 mt-6 transition-all"
                        :class="{ 'card-processing': isLoading }">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold text-brand-800 flex items-center gap-2">
                                <base-icon name="users" icon-class="w-5 h-5 text-success"></base-icon>
                                Usuários do Sistema
                            </h3>
                            <button @click="router.push('users')" :disabled="isLoading"
                                class="text-xs font-bold text-primary hover:text-primary-dark transition-colors disabled:opacity-50">
                                Ver todos →
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="p-4 rounded-xl bg-brand-50 text-center">
                                <div class="text-2xl font-bold text-brand-800">{{ users.length }}</div>
                                <div class="text-xs text-brand-400 font-medium uppercase mt-1">Total</div>
                            </div>
                            <div class="p-4 rounded-xl bg-danger-light text-center">
                                <div class="text-2xl font-bold text-danger">
                                    {{ users.filter(u => u.role === 'dev').length }}
                                </div>
                                <div class="text-xs text-danger font-medium uppercase mt-1">Desenvolvedores</div>
                            </div>
                            <div class="p-4 rounded-xl bg-success-light text-center">
                                <div class="text-2xl font-bold text-success">
                                    {{ users.filter(u => u.role === 'admin').length }}
                                </div>
                                <div class="text-xs text-success font-medium uppercase mt-1">Admins</div>
                            </div>
                            <div class="p-4 rounded-xl bg-warning-light text-center">
                                <div class="text-2xl font-bold text-warning">
                                    {{ users.filter(u => u.role === 'editor').length }}
                                </div>
                                <div class="text-xs text-warning font-medium uppercase mt-1">Editores</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-else-if="router.current === 'settings'">
                    <settings-panel :settings="settings"></settings-panel>
                </div>

                <!-- DEV / SYSTEM TOOLS -->
                <div v-else-if="router.current === 'dev'"
                    class="max-w-4xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <!-- Header Section -->
                    <div class="bg-brand-900 rounded-[2.5rem] p-8 text-white relative overflow-hidden">
                        <div
                            class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -mr-32 -mt-32 pointer-events-none">
                        </div>
                        <div class="relative z-10">
                            <h2 class="text-2xl font-bold mb-2">Painel do Desenvolvedor</h2>
                            <p class="text-brand-200 max-w-xl">Ferramentas avançadas para manutenção do sistema,
                                gestão de dados e diagnósticos.</p>
                        </div>
                    </div>

                    <!-- System Status Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-[2rem] border border-brand-100 shadow-sm">
                            <div class="flex items-center gap-4 mb-4">
                                <div
                                    class="w-12 h-12 rounded-xl bg-success-light text-success flex items-center justify-center">
                                    <base-icon name="database" icon-class="w-6 h-6"></base-icon>
                                </div>
                                <div>
                                    <h3 class="font-bold text-brand-800">CulturaViva Database</h3>
                                    <div class="text-xs font-bold text-brand-400 uppercase tracking-widest">Planilha
                                        Google</div>
                                </div>
                                <div class="ml-auto">
                                    <span
                                        class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest"
                                        :class="systemInfo.database.status === 'connected' ? 'bg-success-light text-success' : 'bg-danger-light text-danger'">
                                        <span class="w-2 h-2 rounded-full animate-pulse"
                                            :class="systemInfo.database.status === 'connected' ? 'bg-success' : 'bg-danger'"></span>
                                        {{ systemInfo.database.status === 'connected' ? 'Online' : 'Erro' }}
                                    </span>
                                </div>
                            </div>
                            <p class="text-sm text-brand-500 mb-6">Conexão estabelecida com a planilha principal de
                                dados.</p>
                            <div class="flex gap-2">
                                <button @click="handleResetAction" :disabled="isLoading && !resetState.ready"
                                    :class="resetState.ready ? 'bg-success-light hover:bg-success text-success border-success-light hover:border-success-hover' : 'bg-danger-light hover:bg-danger text-danger border-danger-light hover:border-danger-hover'"
                                    class="flex-1 border py-3 rounded-xl font-bold text-xs uppercase tracking-widest transition-all flex items-center justify-center gap-2 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed">
                                    <base-icon v-if="isLoading && !resetState.ready" name="loader-2"
                                        icon-class="w-4 h-4 animate-spin"></base-icon>
                                    <base-icon v-else :name="resetState.ready ? 'refresh-cw' : 'trash-2'"
                                        icon-class="w-4 h-4"></base-icon>
                                    {{ resetState.ready ? 'Recarregar Sistema' : (isLoading ? 'Processando...' :
                                    'Resetar DB') }}
                                </button>
                                <a :href="systemInfo.database.url" target="_blank"
                                    class="flex-1 bg-primary-light hover:bg-primary text-primary py-3 rounded-xl font-bold text-xs uppercase tracking-widest transition-all flex items-center justify-center gap-2">
                                    <base-icon name="external-link" icon-class="w-4 h-4"></base-icon> Abrir
                                </a>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-[2rem] border border-brand-100 shadow-sm">
                            <div class="flex items-center gap-4 mb-4">
                                <div
                                    class="w-12 h-12 rounded-xl bg-primary-light text-primary flex items-center justify-center">
                                    <base-icon name="folder" icon-class="w-6 h-6"></base-icon>
                                </div>
                                <div>
                                    <h3 class="font-bold text-brand-800">CulturaViva Assets</h3>
                                    <div class="text-xs font-bold text-brand-400 uppercase tracking-widest">Google
                                        Drive</div>
                                </div>
                                <div class="ml-auto">
                                    <span
                                        class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest"
                                        :class="systemInfo.drive.status === 'connected' ? 'bg-success-light text-success' : 'bg-danger-light text-danger'">
                                        <span class="w-2 h-2 rounded-full animate-pulse"
                                            :class="systemInfo.drive.status === 'connected' ? 'bg-success' : 'bg-danger'"></span>
                                        {{ systemInfo.drive.status === 'connected' ? 'Online' : 'Erro' }}
                                    </span>
                                </div>
                            </div>
                            <p class="text-sm text-brand-500 mb-6">Armazenamento de imagens e documentos do sistema.
                            </p>
                            <div class="flex gap-2">
                                <a :href="systemInfo.drive.url" target="_blank"
                                    class="flex-1 bg-primary-light hover:bg-primary text-primary py-3 rounded-xl font-bold text-xs uppercase tracking-widest transition-all flex items-center justify-center gap-2">
                                    <base-icon name="external-link" icon-class="w-4 h-4"></base-icon> Gerenciar
                                    Arquivos
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Environment Info -->
                    <div class="bg-white p-8 rounded-[2rem] border border-brand-100 shadow-sm">
                        <h3 class="font-bold text-brand-800 mb-6 flex items-center gap-2">
                            <base-icon name="cpu" icon-class="w-5 h-5 text-primary"></base-icon>
                            Ambiente de Execução
                        </h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center py-3 border-b border-brand-50">
                                <span class="text-sm font-medium text-brand-500">Versão da API</span>
                                <span class="font-mono text-xs bg-brand-100 px-2 py-1 rounded text-brand-600">v2.0.1
                                    (Stable)</span>
                            </div>
                            <div class="flex justify-between items-center py-3 border-b border-brand-50">
                                <span class="text-sm font-medium text-brand-500">Usuário do Script</span>
                                <span class="font-mono text-xs bg-brand-100 px-2 py-1 rounded text-brand-600">{{
                                    systemInfo.env ? systemInfo.env.user : 'Carregando...' }}</span>
                            </div>
                            <div class="flex justify-between items-center py-3 border-b border-brand-50">
                                <span class="text-sm font-medium text-brand-500">Build Mode</span>
                                <span
                                    class="inline-flex items-center gap-1.5 px-2 py-1 rounded text-[10px] font-bold uppercase tracking-widest bg-warning-light text-warning">Production</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DEDICATED VIEW: DOCUMENTS -->
                <div v-else-if="router.current === 'documents'">
                    <document-generator-view :documents="documents" :oscs="oscs" :is-loading="isLoading"
                        :processing-ids="processingIds" :data-actions="dataActions" :auth="auth" :ui="ui"
                        @refresh="dataActions.refresh">
                    </document-generator-view>
                </div>

                <!-- GENERIC CRUD VIEWS -->
                <div v-else class="max-w-6xl mx-auto">
                    <base-data-table :title="pageTitle" :columns="columns[router.current] || []"
                        :items="ui[router.current] || []" :loading="isLoading" :processing-ids="processingIds"
                        @create="modal.open(router.current)" @edit="modal.open(router.current, $event)"
                        @status-change="dataActions.save(router.current, { ...$event, status: $event.status === 'active' ? 'inactive' : 'active' }, { showLoading: false })"
                        @delete="dataActions.delete(router.current, $event)"
                        @bulk-delete="dataActions.bulkDelete(router.current, $event)"
                        @bulk-status-change="dataActions.bulkStatusChange(router.current, $event)"
                        @refresh="dataActions.refresh()">

                        <!-- 1. CELL: STATUS -->
                        <template #cell-status="{ item, isBusy }">
                            <button
                                @click.stop="!isBusy && dataActions.save(router.current, { ...item, status: (item.status||'').toLowerCase() === 'active' ? 'inactive' : 'active' }, { showLoading: false })"
                                :disabled="isBusy || processingIds?.includes(item.id || item.email) || (auth.user && String(item.id) === String(auth.user.id))"
                                class="px-2 py-1 rounded-md text-[10px] font-bold uppercase tracking-wide hover:opacity-80 transition-all cursor-pointer group/status flex items-center gap-1"
                                :class="[
                                        (item.status||'').toLowerCase() === 'active' ? 'bg-success-light text-success' : 'bg-danger-light text-danger',
                                        (isBusy || processingIds?.includes(item.id || item.email) || (auth.user && String(item.id) === String(auth.user.id))) ? 'opacity-50 cursor-not-allowed' : ''
                                    ]">
                                <span v-show="!processingIds?.includes(item.id || item.email)"
                                    class="w-1.5 h-1.5 rounded-full inline-block"
                                    :class="(item.status||'').toLowerCase() === 'active' ? 'bg-success' : 'bg-danger'"></span>
                                <span v-show="processingIds?.includes(item.id || item.email)"
                                    class="inline-flex"><base-icon name="loader-2"
                                        icon-class="w-3 h-3 animate-spin"></base-icon></span>
                                {{ (item.status||'').toLowerCase() === 'active' ? 'Ativo' : 'Inativo' }}
                                <span
                                    v-show="!processingIds?.includes(item.id || item.email) && !(auth.user && String(item.id) === String(auth.user.id))"
                                    class="inline-flex"><base-icon name="refresh-cw"
                                        icon-class="w-3 h-3 ml-1 opacity-0 group-hover/status:opacity-100 transition-opacity"></base-icon></span>
                            </button>
                        </template>

                        <!-- 2. CELL: IMAGE / PHOTO -->
                        <template #cell-image="{ val }">
                            <div
                                class="w-10 h-10 rounded-lg bg-brand-100 overflow-hidden relative shadow-sm group-hover:scale-110 transition-transform">
                                <img v-if="val" :src="val" class="w-full h-full object-cover">
                                <base-icon v-else name="image"
                                    icon-class="w-4 h-4 text-brand-300 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></base-icon>
                            </div>
                        </template>
                        <template #cell-photo="{ val }">
                            <div
                                class="w-10 h-10 rounded-full bg-brand-100 overflow-hidden relative shadow-sm group-hover:scale-110 transition-transform">
                                <img v-if="val" :src="val" class="w-full h-full object-cover">
                                <base-icon v-else name="user"
                                    icon-class="w-4 h-4 text-brand-300 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"></base-icon>
                            </div>
                        </template>

                        <!-- 3. CELL: LANGUAGES / TAGS -->
                        <template #cell-languages="{ val }">
                            <div v-if="val && Array.isArray(val)" class="flex gap-1 flex-wrap">
                                <span v-for="lang in val" :key="lang"
                                    class="px-2 py-1 bg-brand-100 text-brand-500 rounded text-[10px] font-bold uppercase border border-brand-200">{{
                                    lang }}</span>
                            </div>
                        </template>
                        <template #cell-tags="{ val }">
                            <div class="flex gap-1 flex-wrap">
                                <span v-for="tag in val" :key="tag"
                                    class="px-2 py-1 bg-primary-light text-primary rounded text-[10px] font-bold uppercase border border-primary-light/30">{{
                                    tag }}</span>
                            </div>
                        </template>

                        <!-- 4. CELL: HIGHLIGHT (NEW) -->
                        <template #cell-highlight="{ item, isBusy }">
                            <button
                                @click.stop="!isBusy && dataActions.save(router.current, { ...item, highlight: !item.highlight }, { showLoading: false })"
                                :disabled="isBusy || processingIds?.includes(item.id)"
                                class="w-8 h-8 rounded-full flex items-center justify-center transition-all hover:bg-brand-50 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed group/star"
                                :class="item.highlight ? 'text-warning' : 'text-brand-300'">
                                <base-icon :name="item.highlight ? 'star' : 'star'"
                                    :icon-class="['w-5 h-5 transition-transform duration-300', item.highlight ? 'fill-warning scale-110' : 'group-hover/star:text-warning/50']"></base-icon>
                            </button>
                        </template>

                        <!-- 5. ACTIONS: DISABLE SELF-DESTRUCT -->
                        <template #actions="{ item, isBusy }">
                            <button @click="modal.open(router.current, item)" :disabled="isBusy"
                                class="p-2 text-primary hover:bg-primary-light rounded-lg transition-colors disabled:pointer-events-none"
                                title="Editar">
                                <base-icon name="edit-2" icon-class="w-4 h-4"></base-icon>
                            </button>
                            <button @click="dataActions.delete(router.current, item)"
                                :disabled="isBusy || (auth.user && String(item.id) === String(auth.user.id))"
                                class="p-2 text-danger hover:bg-danger-light rounded-lg transition-colors disabled:pointer-events-none disabled:opacity-30 disabled:cursor-not-allowed"
                                :title="(auth.user && String(item.id) === String(auth.user.id)) ? 'Você não pode excluir a si mesmo' : 'Excluir'">
                                <base-icon name="trash-2" icon-class="w-4 h-4"></base-icon>
                            </button>
                        </template>

                    </base-data-table>
                </div>
            </div>
        </main>
    </div>

    <!-- CONTEXTO: AUTH (LOGIN) -->
    <base-login-page
        v-else-if="router.currentContext === 'auth' || (router.currentContext === 'admin' && !auth.isAuthenticated)"
        :auth="auth" :router="router" :notifications="notifications" :settings="settings"></base-login-page>

    <!-- MODAL FORM -->
    <base-form-modal :show="modal.visible" :title="modal.title" :fields="modal.fields" v-model="modal.model"
        :saving="modal.isSaving" :collection="modal.collection" @close="modal.close()" @save="modal.save()">

        <!-- SLOT: SIDEBAR (CUSTOM HEADER FOR ALL COLLECTIONS) -->
        <template v-slot:sidebar>
            <div v-if="modal.collection === 'users'" class="mb-8">
                <!-- Decorative Banner -->
                <div class="h-24 md:h-32 bg-primary rounded-2xl relative overflow-hidden -mx-2 -mt-2 shadow-inner">
                    <div class="absolute inset-0 bg-white/10 pattern-grid-lg opacity-30"></div>
                </div>

                <!-- Floating Avatar Preview -->
                <div class="flex flex-col items-center -mt-12 md:-mt-16 relative z-10">
                    <div
                        class="w-24 h-24 md:w-32 md:h-32 rounded-full border-4 border-white shadow-2xl bg-white flex items-center justify-center overflow-hidden relative group">

                        <base-image-preview :src="modal.model.photo" fallback-icon="user"
                            :fallback-text="modal.model.name ? modal.model.name.charAt(0).toUpperCase() : '?'"
                            img-class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                        </base-image-preview>

                        <!-- Click Handler for Photo Update -->
                        <div @click="imageInputModal.open(modal.model.photo, (url) => { modal.model.photo = url; }, 'Alterar Foto de Perfil')"
                            class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white text-xs font-bold uppercase tracking-widest backdrop-blur-sm cursor-pointer z-20">
                            Alterar Foto
                        </div>
                    </div>

                    <!-- User Identifiers -->
                    <div class="mt-4 text-center">
                        <h2 class="text-2xl font-black text-brand-800 tracking-tight">
                            {{ modal.model.name || 'Novo Usuário' }}
                        </h2>
                        <span
                            class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-primary-light text-primary text-[10px] font-bold uppercase tracking-widest border border-primary-light/30 mt-2">
                            <base-icon name="shield" icon-class="w-3 h-3"></base-icon>
                            {{ modal.model.role === 'dev' ? 'Desenvolvedor' : (modal.model.role === 'admin' ?
                            'Administrador' : 'Editor') }}
                        </span>
                        <p v-if="modal.model.photo"
                            class="text-[10px] text-brand-400 mt-2 font-mono truncate max-w-[200px] mx-auto opacity-60">
                            {{ modal.model.photo }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- PREMIUM HEADER FOR CLIPPING -->
            <div v-if="modal.collection === 'clipping'" class="mb-8">
                <!-- Decorative News Banner -->
                <div class="h-24 md:h-32 bg-success rounded-2xl relative overflow-hidden -mx-2 -mt-2 shadow-inner">
                    <div class="absolute inset-0 bg-white/10 pattern-grid-lg opacity-30"></div>
                </div>

                <!-- Floating Clipping Preview -->
                <div class="flex flex-col items-center -mt-12 md:-mt-16 relative z-10">
                    <div
                        class="w-48 h-32 md:w-64 md:h-40 rounded-2xl border-4 border-white shadow-2xl bg-white flex items-center justify-center overflow-hidden relative group">
                        <!-- REUSABLE IMAGE PREVIEW WITH LOADER -->
                        <base-image-preview :src="modal.model.image" fallback-icon="newspaper"
                            img-class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                        </base-image-preview>

                        <!-- Preview Overlay -->
                        <div @click="imageInputModal.open(modal.model.image, (url) => { modal.model.image = url; }, 'Alterar Capa')"
                            class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white text-xs font-bold uppercase tracking-widest backdrop-blur-sm cursor-pointer z-20">
                            Alterar Capa
                        </div>
                    </div>

                    <!-- News Identifiers -->
                    <div class="mt-4 text-center px-4">
                        <h2 class="text-2xl font-black text-brand-800 tracking-tight line-clamp-2">
                            {{ modal.model.title || 'Nova Matéria' }}
                        </h2>
                        <div class="flex items-center justify-center gap-2 mt-2">
                            <span v-if="modal.model.source"
                                class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-success-light text-success text-[10px] font-bold uppercase tracking-widest border border-success-light/30">
                                <base-icon name="external-link" icon-class="w-3 h-3"></base-icon>
                                {{ modal.model.source }}
                            </span>
                            <span v-if="modal.model.date"
                                class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-brand-50 text-brand-500 text-[10px] font-bold uppercase tracking-widest border border-brand-100">
                                <base-icon name="calendar" icon-class="w-3 h-3"></base-icon>
                                {{ formatters.formatDate(modal.model.date) }}
                            </span>
                        </div>
                        <p v-if="modal.model.image"
                            class="text-[10px] text-brand-400 mt-2 font-mono truncate max-w-[250px] mx-auto opacity-60">
                            {{ modal.model.image }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- PREMIUM HEADER FOR EVENTS -->
            <div v-if="modal.collection === 'events'" class="mb-8">
                <!-- Decorative Event Banner -->
                <div class="h-24 md:h-32 bg-primary rounded-2xl relative overflow-hidden -mx-2 -mt-2 shadow-inner">
                    <div class="absolute inset-0 bg-white/10 pattern-grid-lg opacity-30"></div>
                </div>

                <!-- Floating Event Preview -->
                <div class="flex flex-col items-center -mt-12 md:-mt-16 relative z-10">
                    <div
                        class="w-48 h-32 md:w-64 md:h-40 rounded-2xl border-4 border-white shadow-2xl bg-white flex items-center justify-center overflow-hidden relative group">
                        <!-- REUSABLE IMAGE PREVIEW WITH LOADER -->
                        <base-image-preview :src="modal.model.image" fallback-icon="calendar"
                            img-class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                        </base-image-preview>

                        <!-- Preview Overlay -->
                        <div @click="imageInputModal.open(modal.model.image, (url) => { modal.model.image = url; }, 'Alterar Capa')"
                            class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white text-xs font-bold uppercase tracking-widest backdrop-blur-sm cursor-pointer z-20">
                            Alterar Capa
                        </div>

                        <!-- OSC Logo Overlap (Consistência) -->
                        <div class="absolute bottom-2 right-2 z-30 group/osc">
                            <div
                                class="w-12 h-12 rounded-xl bg-white shadow-xl flex items-center justify-center overflow-hidden border-2 border-white relative">

                                <base-image-preview :src="modal.model.osc_logo" fallback-icon="building-2"
                                    img-class="w-full h-full object-cover">
                                </base-image-preview>

                                <div @click.stop="imageInputModal.open(modal.model.osc_logo, (url) => { modal.model.osc_logo = url; }, 'Logotipo da OSC')"
                                    class="absolute inset-0 bg-primary/80 opacity-0 group-hover/osc:opacity-100 transition-opacity flex items-center justify-center text-white cursor-pointer">
                                    <base-icon name="camera" icon-class="w-3.5 h-3.5"></base-icon>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Event Identifiers -->
                    <div class="mt-4 text-center px-4">
                        <h2 class="text-2xl font-black text-brand-800 tracking-tight">
                            {{ modal.model.title || 'Novo Evento' }}
                        </h2>
                        <div class="flex items-center justify-center gap-2 mt-2">
                            <span v-if="modal.model.date"
                                class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-primary-light text-primary text-[10px] font-bold uppercase tracking-widest border border-primary-light/30">
                                <base-icon name="calendar" icon-class="w-3 h-3"></base-icon>
                                {{ formatters.formatDate(modal.model.date) }}
                            </span>
                            <span v-if="modal.model.porte"
                                class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-brand-50 text-brand-500 text-[10px] font-bold uppercase tracking-widest border border-brand-100">
                                <base-icon name="map-pin" icon-class="w-3 h-3"></base-icon>
                                {{ modal.model.porte }}
                            </span>
                        </div>
                        <p v-if="modal.model.image"
                            class="text-[10px] text-brand-400 mt-2 font-mono truncate max-w-[250px] mx-auto opacity-60">
                            {{ modal.model.image }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- PREMIUM HEADER FOR TEAM -->
            <div v-if="modal.collection === 'team'" class="mb-8">
                <!-- Decorative Team Banner -->
                <div class="h-24 md:h-32 bg-brand-900 rounded-2xl relative overflow-hidden -mx-2 -mt-2 shadow-inner">
                    <div class="absolute inset-0 bg-white/5 pattern-grid-lg opacity-20"></div>
                </div>

                <!-- Floating Member Preview -->
                <div class="flex flex-col items-center -mt-12 md:-mt-16 relative z-10">
                    <div
                        class="w-24 h-24 md:w-32 md:h-32 rounded-full border-4 border-white shadow-2xl bg-white flex items-center justify-center overflow-hidden relative group">

                        <base-image-preview :src="modal.model.photo" fallback-icon="user"
                            :fallback-text="modal.model.name ? modal.model.name.charAt(0).toUpperCase() : '?'"
                            img-class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                        </base-image-preview>

                        <!-- Edit Hint Overlay -->
                        <div @click="imageInputModal.open(modal.model.photo, (url) => { modal.model.photo = url; }, 'Alterar Foto do Membro')"
                            class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white text-xs font-bold uppercase tracking-widest backdrop-blur-sm cursor-pointer z-20">
                            Alterar Foto
                        </div>
                    </div>

                    <!-- Member Identifiers -->
                    <div class="mt-4 text-center">
                        <h2 class="text-2xl font-black text-brand-800 tracking-tight">
                            {{ modal.model.name || 'Novo Membro' }}
                        </h2>
                        <span v-if="modal.model.position"
                            class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-brand-50 text-brand-500 text-[10px] font-bold uppercase tracking-widest border border-brand-100 mt-2">
                            <base-icon name="briefcase" icon-class="w-3 h-3"></base-icon>
                            {{ modal.model.position }}
                        </span>
                        <p v-if="modal.model.photo"
                            class="text-[10px] text-brand-400 mt-2 font-mono truncate max-w-[200px] mx-auto opacity-60">
                            {{ modal.model.photo }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- PREMIUM HEADER FOR OSCs -->
            <div v-if="modal.collection === 'oscs'" class="mb-8">
                <!-- Decorative OSC Banner -->
                <div class="h-24 md:h-32 bg-brand-900 rounded-2xl relative overflow-hidden -mx-2 -mt-2 shadow-inner">
                    <div class="absolute inset-0 bg-white/5 pattern-grid-lg opacity-20"></div>
                </div>

                <!-- Floating OSC Preview -->
                <div class="flex flex-col items-center -mt-12 md:-mt-16 relative z-10">
                    <div
                        class="w-24 h-24 md:w-32 md:h-32 rounded-3xl border-4 border-white shadow-2xl bg-white flex items-center justify-center overflow-hidden relative group">

                        <base-image-preview :src="modal.model.osc_logo" fallback-icon="building-2"
                            img-class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                        </base-image-preview>
                    </div>

                    <!-- OSC Identifiers -->
                    <div class="mt-4 text-center">
                        <h2 class="text-2xl font-black text-brand-800 tracking-tight px-4">
                            {{ modal.model.nome || 'Nova Instituição' }}
                        </h2>
                        <div class="flex items-center justify-center gap-2 mt-2">
                            <span v-if="modal.model.cnpj"
                                class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-brand-50 text-brand-500 text-[10px] font-bold uppercase tracking-widest border border-brand-100">
                                <base-icon name="file-text" icon-class="w-3 h-3"></base-icon>
                                CNPJ: {{ modal.model.cnpj }}
                            </span>
                            <span
                                class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest"
                                :class="modal.model.status === 'active' ? 'bg-success-light text-success' : 'bg-danger-light text-danger'">
                                <base-icon :name="modal.model.status === 'active' ? 'check-circle' : 'slash'"
                                    icon-class="w-3 h-3"></base-icon>
                                {{ modal.model.status === 'active' ? 'Ativo' : 'Inativo' }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PREMIUM HEADER FOR TESTIMONIALS -->
            <div v-if="modal.collection === 'testimonials'" class="mb-8">
                <!-- Decorative Testimonials Banner -->
                <div class="h-24 md:h-32 bg-warning rounded-2xl relative overflow-hidden -mx-2 -mt-2 shadow-inner">
                    <div class="absolute inset-0 bg-white/10 pattern-grid-lg opacity-30"></div>
                </div>

                <!-- Floating Author Preview -->
                <div class="flex flex-col items-center -mt-12 md:-mt-16 relative z-10">
                    <div
                        class="w-24 h-24 md:w-32 md:h-32 rounded-full border-4 border-white shadow-2xl bg-white flex items-center justify-center overflow-hidden relative group">
                        <!-- NEW: Reusable Image Preview with Loader -->
                        <base-image-preview :src="modal.model.photo" fallback-icon="quote"
                            img-class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                        </base-image-preview>

                        <!-- Preview Overlay -->
                        <div @click="imageInputModal.open(modal.model.photo, (url) => { modal.model.photo = url; }, 'Alterar Foto do Autor')"
                            class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white text-xs font-bold uppercase tracking-widest backdrop-blur-sm cursor-pointer z-20">
                            Alterar Foto
                        </div>
                    </div>

                    <!-- Author Identifiers -->
                    <div class="mt-4 text-center px-4">
                        <h2 class="text-2xl font-black text-brand-800 tracking-tight">
                            {{ modal.model.author || 'Novo Depoimento' }}
                        </h2>
                        <div class="flex items-center justify-center gap-2 mt-2">
                            <span v-if="modal.model.role"
                                class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-warning-light text-warning text-[10px] font-bold uppercase tracking-widest border border-warning-light/30">
                                {{ modal.model.role }}
                            </span>
                            <span v-if="modal.model.type"
                                class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-brand-50 text-brand-500 text-[10px] font-bold uppercase tracking-widest border border-brand-100">
                                <base-icon
                                    :name="modal.model.type === 'video' ? 'film' : (modal.model.type === 'imagem' ? 'image' : 'file-text')"
                                    icon-class="w-3 h-3"></base-icon>
                                {{ modal.model.type }}
                            </span>
                        </div>
                        <p v-if="modal.model.photo"
                            class="text-[10px] text-brand-400 mt-2 font-mono truncate max-w-[200px] mx-auto opacity-60">
                            {{ modal.model.photo }}
                        </p>
                    </div>
                </div>
            </div>
        </template>
        <base-auto-form v-model="modal.model" :fields="modal.fields" :collection="modal.collection"
            :saving="modal.isSaving" :attempted-save="modal.attemptedSave">
        </base-auto-form>

    </base-form-modal>

    <!-- IMAGE INPUT MODAL (NEW) -->
    <base-image-input-modal :show="imageInputModal.show" :url="imageInputModal.url" :title="imageInputModal.title"
        @save="(val) => imageInputModal.save(val)" @close="imageInputModal.close()"></base-image-input-modal>

    <!-- MEDIA MODAL -->
    <base-media-modal :show="mediaModal.show" :type="mediaModal.type" :url="mediaModal.url" :title="mediaModal.title"
        @close="mediaModal.close()"></base-media-modal>

    <!-- BACKDROP TO CLOSE MENU -->
    <!-- (Backdrop is now handled by dropdown-menu and admin-user-menu components) -->

    <!-- APP ENTRY POINT -->
    <script src="js/utils/AppUtils.js"></script>
    <script src="js/utils/Formatters.js"></script>
    <script src="js/services/GASAPIService.js"></script>
    <script src="js/services/DataService.js"></script>
    <script src="js/services/ExportService.js"></script>
    <script src="js/composables/useLocalStorage.js"></script>
    <script src="js/composables/useUIState.js"></script>
    <script src="js/composables/useUISettings.js"></script>
    <script src="js/composables/useData.js"></script>
    <script src="js/composables/useAuth.js"></script>
    <script src="js/composables/useNavigation.js"></script>
    <script src="js/composables/useHeroSlider.js"></script>
    <script src="js/composables/useAuthGuards.js"></script>
    <script src="js/composables/useUI.js"></script>

    <!-- ✅ SOLID REFACTOR: Novos Composables -->
    <script src="js/composables/useValidation.js"></script>
    <script src="js/composables/useErrorHandler.js"></script>
    <script src="js/composables/useDataOperations.js"></script>

    <script src="js/composables/usePublicFilter.js"></script>
    <script src="js/composables/useTable.js"></script>
    <script src="js/composables/useModal.js"></script>
    <script src="js/composables/useConfirm.js"></script>
    <script src="js/composables/useColumnVisibility.js"></script>
    <script src="js/components/BaseIcon.js"></script>

    <!-- ✅ SOLID REFACTOR: Componentes Reutilizáveis -->
    <script src="js/components/StatsCard.js"></script>
    <script src="js/components/EventCard.js"></script>

    <script src="js/components/DropdownMenu.js"></script>
    <script src="js/components/AdminUserMenu.js"></script>
    <script src="js/components/BaseFormField.js"></script>
    <script src="js/components/BaseImagePreview.js"></script>
    <script src="js/components/BaseAutoForm.js"></script>
    <script src="js/components/BaseDataTable.js"></script>
    <script src="js/components/BaseLoginPage.js"></script>
    <script src="js/components/BaseFormModal.js"></script>
    <script src="js/components/BaseImageInputModal.js"></script>
    <script src="js/components/BaseMediaModal.js"></script>
    <script src="js/components/BaseConfirmDialog.js"></script>
    <script src="js/components/BasePublicArchive.js"></script>
    <script src="js/components/SettingsPanel.js"></script>

    <!-- Models -->
    <script src="js/models/SchemaDefinitions.js"></script>
    <script src="js/models/DocumentTemplates.js"></script>

    <!-- Dedicated Views -->
    <script src="js/components/DocumentGeneratorView.js"></script>

    <script src="js/main.js"></script>
</body>

</html>